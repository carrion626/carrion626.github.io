<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Main page</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="preview">
        <img id="image" src="images/huyatina.jpg" style="display: block; max-width: calc(100vw - 40px); max-height: calc(100vh - 40px); margin: auto; padding: 20px;">
        <button id="next" style="position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);">Next -></button>
    </div>



    <div id="first_reg" style="display: none;">
        <div class="image-frame">
            <img src="images/huyatina.jpg" alt="Huyatina Image">
        </div>
        <h1>Dentist Event</h1>
        <form method="POST">
            <!-- ADD "REQUIRED TO EVERY FIELD" -->
            <input type="text" id="name" placeholder="Name" required> 
            <input type="text" id="lastname" placeholder="Last Name" >
            <input type="text" id="email" placeholder="e-mail@gmail.com" >
            <input type="text" id="tel" placeholder="Tel no (+380_____)" >
            <input type="text" id="city" placeholder="City" >
            <input type="text" id="school" placeholder="school" >
            <input type="text" id="position" placeholder="position">
            <button id="register">Register</button>
        </form>
    </div>

    <!-- <script>
        const images = ['huyatina.jpg', 'fhfhfh.jpeg', '33212.jpg', 'ысрувгду.jpg', 'huyatina.jpg'];
        let currentIndex = 0;

        let tg = window.Telegram.WebApp;
        tg.expand()
        tg.ready()

        const image = document.getElementById('image');
        const previewDiv = document.getElementById('preview');
        const firstRegDiv = document.getElementById('first_reg');
        const nextButton = document.getElementById('next');
        const registerButton = document.getElementById('register');

        nextButton.addEventListener('click', () => {
            // Update the index for the next image
            currentIndex = (currentIndex + 1) % images.length;
            
            if (currentIndex === 0) {
                // If the end is reached, hide "preview" and show "first_reg"
                previewDiv.style.display = 'none';
                firstRegDiv.style.display = 'block';
            } else {
                // Set the 'src' attribute to the next image
                image.src = 'images/' + images[currentIndex];
            }

        });

        document.body.addEventListener('click', (event) => {
            const clickedElement = event.target;

            if (clickedElement.tagName !== 'INPUT' && clickedElement !== registerButton) {
                document.activeElement.blur();
            }
        });
    </script> -->

    <script>
        let reg = document.getElementById("register");
    
        reg.addEventListener("click", async (event) => {
            // Prevent the default form submission behavior
            event.preventDefault();

            // Get input values
            let name = document.getElementById("name").value;
            let last_name = document.getElementById("lastname").value;
            let email = document.getElementById("email").value;
            let tel = document.getElementById("tel").value;

            // Basic checks
            if (!name || !last_name || !email || !tel) {
                alert("Please fill in all required fields.");
                return;
            }

            let data = {
                name: name,
                last_name: last_name,
                email: email,
                tel: tel
            };

            try {
                // Make an HTTP POST request to your server
                let response = await fetch('http://localhost:3000/submit_registration', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data),
                });

                if (response.ok) {
                    // Server successfully processed the request
                    let responseData = await response.json();
                    console.log(responseData);

                    // Redirect or perform other actions based on the response
                    window.location.href = 'https://carrion626.github.io/home.html';
                } else {
                    console.error('Server returned an error:', response.status);
                }
            } catch (error) {
                console.error('Error:', error);
            }
        });

    </script>
      
</body>
</html>