<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">
    <title>Main page</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="style.css">
    <style>
        /* CSS for the <br> elements */
        .br-element {
            display: none; /* Initially hidden */
        }
    </style>
</head>
<body>

    <div id="preview">
        <img id="imagefirst" src="images/preview1.jpg">
    </div>

    <div id="first_reg" style="display: none;">
        <div class="main-image-frame">
            <img src="images/logo.jpg" alt="Huyatina Image">
        </div>
        <br>
        <h1>Регистрация</h1>
        <hr style="border: 0; height: 1px; background-color: #ccc; margin: 30px 0;">

        <form method="POST">
            <!-- ADD "REQUIRED TO EVERY FIELD" -->
            <input type="text" id="name" placeholder="Имя" required> 
            <input type="text" id="lastname" placeholder="Фамилия" >
            <input type="text" id="email" placeholder="e-mail@gmail.com" >
            <input type="text" id="tel" placeholder="Телефон" >
            <input type="text" id="city" placeholder="Город" >
            <!-- <input type="text" id="school" placeholder="school" >
            <input type="text" id="position" placeholder="position"> -->
            <button id="register">Зарегистрироваться</button>
        </form>
    </div>

    <!-- <br> elements for adjusting page layout -->
    <br class="br-element" id="br1">

    <script>
        const registerButton = document.getElementById('register');
        
        // Get references to the <br> elements
        const brElements = document.querySelectorAll('.br-element');

        // Function to handle focus event
        function handleFocus() {
            // Show <br> elements when the keyboard is opened
            brElements.forEach(br => {
                br.style.display = 'block';
            });
        }

        // Function to handle blur event
        function handleBlur() {
            // Hide <br> elements when the keyboard is closed
            brElements.forEach(br => {
                br.style.display = 'none';
            });
        }

        // Add event listeners for focus and blur events
        window.addEventListener('focus', handleFocus);
        window.addEventListener('blur', handleBlur);

        // Event listener for registration button click
        registerButton.addEventListener('click', async (event) => {
            event.preventDefault(); // Prevent form submission

            // Get input values
            let name = document.getElementById("name").value;
            let last_name = document.getElementById("lastname").value;
            let email = document.getElementById("email").value;
            let tel = document.getElementById("tel").value;

            // Basic checks
            if (!name || !last_name || !email || !tel) {
                alert("Please fill in all required fields.");
                return;
            }

            let data = {
                name: name,
                last_name: last_name,
                email: email,
                tel: tel,
                id: window.Telegram.WebApp.initDataUnsafe.user.id // Change to access the user ID correctly
            };

            try {
                // Make an HTTP POST request to your server
                let response = await fetch('https://11d8-2a02-ff0-220-a1c6-e1bd-b960-4080-14ca.ngrok-free.app/submit_registration', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data),
                });

                if (response.ok) {
                    // Server successfully processed the request
                    let responseData = await response.json();
                    console.log(responseData);
                    window.Telegram.WebApp.showAlert("Registration successful!", () => {
                        // Callback function after the alert is closed
                        // Redirect to the home page
                        window.location.href = 'https://carrion626.github.io/home.html';
                    });
                } else {
                    console.error('Server returned an error:', response.status);
                }
            } catch (error) {
                console.error('Error:', error);
            }
        });

    </script>
</body>
</html>
